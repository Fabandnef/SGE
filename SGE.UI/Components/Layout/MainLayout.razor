@using SGE.Aplicacion.CasosDeUso

@inherits LayoutComponentBase

@inject Session                   CurrentSession
@inject NavigationManager         NavigationManager
<div class="h-full w-full flex flex-col">
    <NavBar OnToggleMenu="ToggleMenu" Usuario="@Usuario"/>

    <div class="flex flex-grow flex-row">
        <div>
            <NavMenu IsOpen="@_menuVisible"/>
        </div>

        <main class="w-full h-full">
            @Body
        </main>
    </div>
</div>

@code {

    private bool _menuVisible;

    private Usuario? Usuario => CurrentSession.Usuario;

    private void ToggleMenu() {
        _menuVisible = !_menuVisible;
        StateHasChanged();
    }

    protected override void OnInitialized() {
        string currentUri = NavigationManager.ToBaseRelativePath(NavigationManager.Uri).ToLower();

        if ((CurrentSession.Usuario == null)
         && !string.IsNullOrEmpty(currentUri)
         && !currentUri.StartsWith("login")
         && !currentUri.StartsWith("register")) {
            NavigationManager.NavigateTo("/", true);
        }
        
        base.OnInitialized();
    }

}